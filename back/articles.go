package main

import (
    "database/sql"
    "encoding/json"
    "net/http"
    "strings"
)

// Article represents an article item
type Article struct {
    ID          int64  `json:"id"`
    Title       string `json:"title"`
    ShortText   string `json:"short_text"`
    FullText    string `json:"full_text"`
    PublishedAt string `json:"published_at"` // YYYY-MM-DD
}

// Seed default articles (id is auto). If an article with the same title exists, it is skipped.
func seedDefaultArticles() error {
    seeds := []Article{
        {
            Title: "Как выбрать арматуру для строительства: полное руководство",
            ShortText: "Выбор арматуры определяет прочность конструкции. Учитывайте соответствие ГОСТ и типы (А500С, А3). Обратите внимание на диаметр и коррозионную стойкость. Основные типы арматуры.",
            FullText: `
                <h3>Выбор арматуры для строительства: комплексное руководство</h3>
                <p>Арматура — ключевой элемент железобетонных конструкций, определяющий их прочность, долговечность и устойчивость к нагрузкам. Правильный выбор арматуры требует понимания технических характеристик и нормативных требований.</p>

                <h4>Основные типы арматуры</h4>
                <ul>
                    <li><strong>А500С</strong> — наиболее распространенный класс для гражданского строительства</li>
                    <li><strong>А3 (А400)</strong> — горячекатаная арматура периодического профиля</li>
                    <li><strong>А800</strong> — высокопрочная арматура для ответственных конструкций</li>
                    <li><strong>А240</strong> — гладкая арматура для конструктивного армирования</li>
                </ul>

                <h4>Технические характеристики</h4>
                <table>
                    <tr><th>Параметр</th><th>Значение</th><th>Примечание</th></tr>
                    <tr><td>Диаметр стержней</td><td>6-40 мм</td><td>Для фундаментов 12-16 мм</td></tr>
                    <tr><td>Предел текучести</td><td>500 Н/мм² (А500С)</td><td>ГОСТ 5781-82</td></tr>
                    <tr><td>Свариваемость</td><td>Хорошая (А500С)</td><td>Без ограничений</td></tr>
                    <tr><td>Коррозионная стойкость</td><td>Зависит от покрытия</td><td>Оцинкованная лучше</td></tr>
                </table>

                <h4>Критерии выбора</h4>
                <ol>
                    <li><strong>Соответствие ГОСТ</strong> — требуйте сертификаты качества</li>
                    <li><strong>Диаметр стержней</strong> — согласно проектной документации</li>
                    <li><strong>Класс прочности</strong> — в зависимости от нагрузок</li>
                    <li><strong>Геометрия профиля</strong> — обеспечивает сцепление с бетоном</li>
                    <li><strong>Отсутствие дефектов</strong> — трещины, расслоения недопустимы</li>
                </ol>

                <h4>Рекомендации по применению</h4>
                <p>Для фундаментов частных домов используйте арматуру А500С диаметром 12-14 мм. В многоэтажном строительстве применяйте стержни 16-20 мм класса А800. Для дорожных плит и мостовых конструкций выбирайте арматуру с повышенной коррозионной стойкостью.</p>

                <h4>Контроль качества</h4>
                <ul>
                    <li>Визуальный осмотр на отсутствие ржавчины</li>
                    <li>Проверка геометрических параметров</li>
                    <li>Запрос сертификатов соответствия</li>
                    <li>Испытание на растяжение (при необходимости)</li>
                </ul>`,
            PublishedAt: "2024-01-10",
        },
        {
            Title: "Технологии производства профнастила: от сырья до готовой продукции",
            ShortText: "Профнастил изготавливают путем прокатки стали. Защитные покрытия повышают его долговечность. Используется в кровле и фасадах. Технологии производства профнастила: инновации и традиции.",
            FullText: `
                <h3>Технологии производства профнастила: инновации и традиции</h3>
                <p>Профнастил — один из самых востребованных материалов в современном строительстве, сочетающий прочность, легкость и долговечность. Производственный процесс включает несколько критически важных этапов.</p>

                <h4>Этапы производства</h4>
                <ol>
                    <li><strong>Подготовка сырья</strong> — оцинкованная сталь толщиной 0,4-1,2 мм</li>
                    <li><strong>Резка в размер</strong> — точная нарезка рулонной стали</li>
                    <li><strong>Формовка профиля</strong> — холодный прокат на профилегибочных станках</li>
                    <li><strong>Нанесение покрытий</strong> — полимерные защитные слои</li>
                    <li><strong>Контроль качества</strong> — проверка геометрии и прочности</li>
                </ol>

                <h4>Типы профнастила и характеристики</h4>
                <table>
                    <tr><th>Марка</th><th>Высота профиля</th><th>Толщина стали</th><th>Область применения</th></tr>
                    <tr><td>С8</td><td>8 мм</td><td>0,4-0,7 мм</td><td>Декоративные ограждения, облицовка</td></tr>
                    <tr><td>С20</td><td>20 мм</td><td>0,5-0,8 мм</td><td>Кровля, стеновые панели</td></tr>
                    <tr><td>Н35</td><td>35 мм</td><td>0,7-1,0 мм</td><td>Несущие конструкции, перекрытия</td></tr>
                    <tr><td>Н60</td><td>60 мм</td><td>0,8-1,2 мм</td><td>Профнастил для кровли промышленных зданий</td></tr>
                </table>

                <h4>Полимерные покрытия</h4>
                <ul>
                    <li><strong>Polyester (PE)</strong> — стандартное покрытие, толщина 25 мкм</li>
                    <li><strong>Polyurethane (Pural)</strong> — повышенная стойкость, 50 мкм</li>
                    <li><strong>PVDF</strong> — премиальное покрытие, устойчивое к УФ</li>
                    <li><strong>Plastisol</strong> — толстое покрытие (200 мкм) для агрессивных сред</li>
                </ul>

                <h4>Контроль качества</h4>
                <p>Каждая партия профнастила проходит многоуровневый контроль:</p>
                <ul>
                    <li>Измерение толщины цинкового слоя (не менее 275 г/м²)</li>
                    <li>Проверка адгезии полимерного покрытия</li>
                    <li>Контроль геометрических параметров профиля</li>
                    <li>Испытание на изгиб и прочность</li>
                </ul>

                <h4>Инновации в производстве</h4>
                <p>Современные производства используют роботизированные линии с ЧПУ, позволяющие производить до 5000 м² профнастила в смену. Лазерная резка обеспечивает точность до 0,1 мм. Системы автоматического контроля исключают человеческий фактор.</p>`,
            PublishedAt: "2024-02-25",
        },
        {
            Title: "Преимущества оцинкованного листа в современном строительстве и промышленности",
            ShortText: "Оцинкованный лист устойчив к коррозии. Он прост в обработке и универсален. Подходит для строительства и промышленности. Оцинкованная сталь.",
            FullText: `
                <h3>Оцинкованный лист: технологические преимущества и области применения</h3>
                <p>Оцинкованная сталь — материал, который изменил современное строительство благодаря сочетанию прочности, долговечности и экономической эффективности.</p>

                <h4>Технология производства</h4>
                <p>Процесс горячего цинкования включает несколько этапов:</p>
                <ol>
                    <li><strong>Обезжиривание</strong> — удаление загрязнений щелочными растворами</li>
                    <li><strong>Травление</strong> — обработка соляной кислотой для удаления окалины</li>
                    <li><strong>Флюсование</strong> — подготовка поверхности для адгезии цинка</li>
                    <li><strong>Цинкование</strong> — погружение в ванну с расплавленным цинком (450°C)</li>
                    <li><strong>Охлаждение</strong> — контролируемое охлаждение для формирования покрытия</li>
                </ol>

                <h4>Классы цинкования по ГОСТ 14918-80</h4>
                <table>
                    <tr><th>Класс покрытия</th><th>Толщина цинка</th><th>Масса покрытия</th><th>Срок службы</th></tr>
                    <tr><td>Повышенный</td><td>40-60 мкм</td><td>570-855 г/м²</td><td>40-50 лет</td></tr>
                    <tr><td>1 класс</td><td>18-40 мкм</td><td>258-570 г/м²</td><td>25-40 лет</td></tr>
                    <tr><td>2 класс</td><td>10-18 мкм</td><td>142-258 г/м²</td><td>15-25 лет</td></tr>
                </table>

                <h4>Преимущества оцинкованного листа</h4>
                <ul>
                    <li><strong>Коррозионная стойкость</strong> — цинк защищает сталь электрохимически</li>
                    <li><strong>Механическая прочность</strong> — предел прочности 270-500 МПа</li>
                    <li><strong>Легкость обработки</strong> — штамповка, гибка, резка без повреждения покрытия</li>
                    <li><strong>Экономичность</strong> — низкая стоимость жизненного цикла</li>
                    <li><strong>Экологичность</strong> — возможность вторичной переработки</li>
                </ul>

                <h4>Области применения</h4>
                <ul>
                    <li><strong>Строительство</strong> — кровля, фасады, водосточные системы</li>
                    <li><strong>Автомобильная промышленность</strong> — кузовные детали</li>
                    <li><strong>Бытовая техника</strong> — корпуса приборов</li>
                    <li><strong>Сельское хозяйство</strong> — силосные башни, хранилища</li>
                    <li><strong>Пищевая промышленность</strong> — оборудование и ёмкости</li>
                </ul>

                <h4>Сравнение с альтернативами</h4>
                <table>
                    <tr><th>Материал</th><th>Срок службы</th><th>Стоимость</th><th>Технологичность</th></tr>
                    <tr><td>Оцинкованная сталь</td><td>25-50 лет</td><td>Средняя</td><td>Отличная</td></tr>
                    <tr><td>Нержавеющая сталь</td><td>50+ лет</td><td>Высокая</td><td>Хорошая</td></tr>
                    <tr><td>Алюминий</td><td>30-40 лет</td><td>Высокая</td><td>Отличная</td></tr>
                    <tr><td>Черная сталь</td><td>5-10 лет</td><td>Низкая</td><td>Хорошая</td></tr>
                </table>

                <h4>Инновационные разработки</h4>
                <p>Современные технологии включают нанесение многослойных покрытий (цинк-алюминий-магний), которые увеличивают срок службы до 70 лет. Разрабатываются экологичные методы цинкования с пониженным энергопотреблением.</p>`,
            PublishedAt: "2024-05-15",
        },
        {
            Title: "Швеллеры: конструкционные особенности, виды и области применения в строительстве",
            ShortText: "Швеллеры бывают П- и У-образные. Используются в каркасах и мостостроении. Горячекатаные прочнее гнутых. Классификация швеллеров. Основные типоразмеры по ГОСТ 8240-97.",
            FullText: `
                <h3>Швеллеры: технические характеристики и практическое применение</h3>
                <p>Швеллеры представляют собой металлические профили П-образного сечения, которые играют важную роль в создании несущих каркасов и конструкций различного назначения.</p>

                <h4>Классификация швеллеров</h4>
                <table>
                    <tr><th>Тип</th><th>Технология производства</th><th>Преимущества</th><th>Недостатки</th></tr>
                    <tr><td>Горячекатаный</td><td>Прокатка при высокой температуре</td><td>Высокая прочность, точная геометрия</td><td>Высокая стоимость</td></tr>
                    <tr><td>Гнутый</td><td>Холодная гибка листовой стали</td><td>Экономичность, легкий вес</td><td>Меньшая прочность</td></tr>
                    <tr><td>Специальный</td><td>Индивидуальное производство</td><td>Нестандартные размеры</td><td>Длительное изготовление</td></tr>
                </table>

                <h4>Основные типоразмеры по ГОСТ 8240-97</h4>
                <table>
                    <tr><th>Номер швеллера</th><th>Высота, мм</th><th>Ширина полки, мм</th><th>Толщина стенки, мм</th><th>Масса 1м, кг</th></tr>
                    <tr><td>10П</td><td>100</td><td>46</td><td>4.5</td><td>8.59</td></tr>
                    <tr><td>12П</td><td>120</td><td>52</td><td>4.8</td><td>10.4</td></tr>
                    <tr><td>14П</td><td>140</td><td>58</td><td>4.9</td><td>12.3</td></tr>
                    <tr><td>16П</td><td>160</td><td>64</td><td>5.0</td><td>14.2</td></tr>
                    <tr><td>20П</td><td>200</td><td>76</td><td>5.2</td><td>18.4</td></tr>
                </table>

                <h4>Области применения</h4>
                <ul>
                    <li><strong>Строительство</strong> — колонны, балки, перекрытия</li>
                    <li><strong>Мостостроение</strong> — элементы пролетных строений</li>
                    <li><strong>Машиностроение</strong> — рамы станков, опорные конструкции</li>
                    <li><strong>Вагоностроение</strong> — каркасы вагонов и платформ</li>
                    <li><strong>Сельское хозяйство</strong> — конструкции теплиц, элеваторов</li>
                </ul>

                <h4>Расчет несущей способности</h4>
                <p>Для расчета швеллера на прочность используются следующие параметры:</p>
                <ul>
                    <li>Момент инерции (Jx, Jy)</li>
                    <li>Момент сопротивления (Wx, Wy)</li>
                    <li>Радиус инерции (ix, iy)</li>
                    <li>Статический момент (Sx)</li>
                </ul>

                <h4>Пример расчета для швеллера 20П</h4>
                <table>
                    <tr><th>Параметр</th><th>Значение</th><th>Единицы измерения</th></tr>
                    <tr><td>Момент инерции Jx</td><td>1840</td><td>см⁴</td></tr>
                    <tr><td>Момент сопротивления Wx</td><td>184</td><td>см³</td></tr>
                    <tr><td>Допустимая нагрузка</td><td>3200</td><td>кг/м</td></tr>
                    <tr><td>Прогиб при нагрузке</td><td>L/200</td><td>от пролета</td></tr>
                </table>

                <h4>Монтажные особенности</h4>
                <ol>
                    <li>Резка — газовой резкой или абразивными дисками</li>
                    <li>Сварка — ручная дуговая сварка электродами Э42-Э50</li>
                    <li>Крепление — болтовые соединения класса 5.6-8.8</li>
                    <li>Антикоррозионная защита — грунтовка и покраска</li>
                </ol>`,
            PublishedAt: "2024-07-20",
        },
        {
            Title: "Экологичные технологии в металлургии: путь к устойчивому развитию отрасли",
            ShortText: "Металлургия снижает выбросы CO2. Электродуговые печи эффективны. Переработка лома экономит ресурсы. Экологическая трансформация металлургической промышленности.",
            FullText: `
                <h3>Экологическая трансформация металлургической промышленности</h3>
                <p>Металлургическая отрасль переживает трансформацию, направленную на снижение экологического воздействия и переход к принципам экономики замкнутого цикла.</p>

                <h4>Ключевые экологические проблемы металлургии</h4>
                <table>
                    <tr><th>Проблема</th><th>Вклад в загрязнение</th><th>Способы решения</th></tr>
                    <tr><td>Выбросы CO2</td><td>7% глобальных выбросов</td><td>CCS технологии, водород</td></tr>
                    <tr><td>Потребление воды</td><td>15-20 м³/т стали</td><td>Замкнутые циклы воды</td></tr>
                    <tr><td>Энергопотребление</td><td>20-25 ГДж/т стали</td><td>Энергоэффективные печи</td></tr>
                    <tr><td>Отходы производства</td><td>400-600 кг/т стали</td><td>Переработка шлаков</td></tr>
                </table>

                <h4>Инновационные зеленые технологии</h4>
                <ul>
                    <li><strong>ELECTROSTEP</strong> — электролиз расплавленных оксидов</li>
                    <li><strong>HYBRIT</strong> — водородное прямое восстановление железа</li>
                    <li><strong>Carbon Capture</strong> — улавливание и хранение углерода</li>
                    <li><strong>EAF Optimization</strong> — оптимизация электродуговых печей</li>
                </ul>

                <h4>Экономика зеленой металлургии</h4>
                <table>
                    <tr><th>Технология</th><th>Капитальные затраты</th><th>Экологический эффект</th><th>Окупаемость</th></tr>
                    <tr><td>Электропечи</td><td>$500-800/т</td><td>-60% CO2</td><td>3-4 года</td></tr>
                    <tr><td>Водородные технологии</td><td>$1000-1200/т</td><td>-95% CO2</td><td>5-7 лет</td></tr>
                    <tr><td>CCS системы</td><td>$50-100/т CO2</td><td>-90% выбросов</td><td>4-6 лет</td></tr>
                    <tr><td>Рециклинг воды</td><td>$20-30/т</td><td>-70% воды</td><td>2-3 года</td></tr>
                </table>

                <h4>Мировые тренды и регулятория</h4>
                <ul>
                    <li>Европейский Green Deal — углеродный налог на импорт</li>
                    <li>CBAM (Carbon Border Adjustment Mechanism)</li>
                    <li>Национальные стратегии декарбонизации</li>
                    <li>ESG отчетность и раскрытие информации</li>
                </ul>

                <h4>Кейсы успешного внедрения</h4>
                <ol>
                    <li><strong>ThyssenKrupp</strong> — водородные пилотные проекты в Германии</li>
                    <li><strong>ArcelorMittal</strong> — технологии Smart Carbon в Бельгии</li>
                    <li><strong>НЛМК</strong> — экологическая модернизация в России</li>
                    <li><strong>POSCO</strong> — FINEX technology в Южной Корее</li>
                </ol>

                <h4>Российские реалии и перспективы</h4>
                <p>Российские металлургические компании инвестируют в экологические проекты:</p>
                <ul>
                    <li>Модернизация газоочистного оборудования — 120 млрд руб до 2030</li>
                    <li>Внедрение Best Available Techniques (НДТ)</li>
                    <li>Разработка водородных кластеров на Урале и в Сибири</li>
                    <li>Создание carbon-free производств к 2050 году</li>
                </ul>`,
            PublishedAt: "2024-10-30",
        },
        {
            Title: "Трубы профильные: технические характеристики, выбор и применение в строительных конструкциях",
            ShortText: "Профильные трубы выбирают по размеру. Учитывайте толщину стенки и материал. Они подходят для каркасов. Классификация профильных труб. Технические характеристики по ГОСТ 8645-68.",
            FullText: `
                <h3>Профильные трубы: от выбора до монтажа в строительных конструкциях</h3>
                <p>Профильные трубы стали незаменимым элементом современного строительства благодаря отличному соотношению прочности и веса.</p>

                <h4>Классификация профильных труб</h4>
                <table>
                    <tr><th>Форма сечения</th><th>Стандартные размеры</th><th>Область применения</th><th>Преимущества</th></tr>
                    <tr><td>Квадратная</td><td>20x20 - 400x400 мм</td><td>Колонны, стойки</td><td>Равнопрочность</td></tr>
                    <tr><td>Прямоугольная</td><td>40x20 - 500x300 мм</td><td>Балки, фермы</td><td>Высокая жесткость</td></tr>
                    <tr><td>Овальная</td><td>Специальные размеры</td><td>Декоративные элементы</td><td>Эстетичность</td></tr>
                    <tr><td>Каплевидная</td><td>Специальные размеры</td><td>Аэродинамические конструкции</td><td>Обтекаемость</td></tr>
                </table>

                <h4>Технические характеристики по ГОСТ 8645-68</h4>
                <table>
                    <tr><th>Размер, мм</th><th>Толщина стенки, мм</th><th>Масса 1м, кг</th><th>Момент инерции, см⁴</th><th>Момент сопротивления, см³</th></tr>
                    <tr><td>40x40</td><td>2</td><td>2.29</td><td>7.69</td><td>3.84</td></tr>
                    <tr><td>40x40</td><td>3</td><td>3.36</td><td>10.7</td><td>5.35</td></tr>
                    <tr><td>60x40</td><td>2</td><td>2.65</td><td>15.4</td><td>5.13</td></tr>
                    <tr><td>60x40</td><td>3</td><td>3.87</td><td>21.8</td><td>7.27</td></tr>
                    <tr><td>80x40</td><td>3</td><td>4.71</td><td>38.1</td><td>9.53</td></tr>
                    <tr><td>100x50</td><td>4</td><td>8.07</td><td>108</td><td>21.6</td></tr>
                </table>

                <h4>Методы производства</h4>
                <ul>
                    <li><strong>Горячее деформирование</strong> — высокая прочность, точность ±1%</li>
                    <li><strong>Холодное деформирование</strong> — гладкая поверхность, точность ±0.5%</li>
                    <li><strong>Сварка + формовка</strong> — экономичность, большие размеры</li>
                    <li><strong>Прецизионная прокатка</strong> — для высокоточных применений</li>
                </ul>

                <h4>Расчетные параметры для проектирования</h4>
                <ol>
                    <li><strong>Момент инерции (I)</strong> — определяет жесткость на изгиб</li>
                    <li><strong>Момент сопротивления (W)</strong> — характеризует прочность</li>
                    <li><strong>Радиус инерции (i)</strong> — для расчета устойчивости</li>
                    <li><strong>Площадь сечения (A)</strong> — для расчета на растяжение/сжатие</li>
                </ol>

                <h4>Пример расчета фермы из профильных труб</h4>
                <table>
                    <tr><th>Пролет фермы</th><th>Нагрузка</th><th>Рекомендуемый профиль</th><th>Масса конструкции</th></tr>
                    <tr><td>12 м</td><td>150 кг/м²</td><td>60x40x3 мм</td><td>180 кг</td></tr>
                    <tr><td>18 м</td><td>200 кг/м²</td><td>80x40x4 мм</td><td>320 кг</td></tr>
                    <tr><td>24 м</td><td>250 кг/м²</td><td>100x50x4 мм</td><td>480 кг</td></tr>
                    <tr><td>30 м</td><td>300 кг/м²</td><td>120x60x5 мм</td><td>720 кг</td></tr>
                </table>

                <h4>Защита от коррозии</h4>
                <ul>
                    <li><strong>Горячее цинкование</strong> — срок службы 25-50 лет</li>
                    <li><strong>Порошковая покраска</strong> — декоративный вид, 15-20 лет</li>
                    <li><strong>Анодирование</strong> — для алюминиевых профилей</li>
                    <li><strong>Комбинированные покрытия</strong> — цинк + полимер</li>
                </ul>`,
            PublishedAt: "2025-03-05",
        },
        {
            Title: "Двутавровые балки в строительстве",
            ShortText: "Двутавровые балки распределяют нагрузки. Используются в перекрытиях и мостах. Соответствие ГОСТ важно.",
            FullText: `
                <h3>Двутавровые балки: ключевой элемент строительных конструкций</h3>
                <p>Двутавровые балки (20Б1) — ключевой элемент для создания прочных перекрытий, обеспечивающий эффективное распределение нагрузок.</p>

                <h4>Преимущества двутавровых балок</h4>
                <ul>
                    <li>Высокая несущая способность</li>
                    <li>Оптимальное распределение нагрузок</li>
                    <li>Универсальность применения</li>
                    <li>Соответствие ГОСТ 26020-83</li>
                </ul>

                <h4>Области применения</h4>
                <table>
                    <tr><th>Сфера</th><th>Примеры использования</th></tr>
                    <tr><td>Строительство</td><td>Перекрытия, колонны</td></tr>
                    <tr><td>Мостостроение</td><td>Пролетные строения</td></tr>
                    <tr><td>Промышленность</td><td>Крановые пути</td></tr>
                </table>

                <h4>Рекомендации по выбору</h4>
                <p>Выбирайте балки в соответствии с проектными нагрузками и ГОСТ. Проверяйте сертификаты качества и геометрические параметры.</p>`,
            PublishedAt: "2025-06-18",
        },
        {
            Title: "Уголки стальные: универсальность применения",
            ShortText: "Стальные уголки бывают равнополочные. Используются в каркасах и декоре. Выбирайте по прочности.",
            FullText: `
                <h3>Стальные уголки: универсальность и надежность</h3>
                <p>Стальные уголки (25x25, 50x50) — универсальный материал для строительства и производства, применяемый в каркасах и декоративных элементах.</p>

                <h4>Типы уголков</h4>
                <ul>
                    <li>Равнополочные (25x25, 50x50)</li>
                    <li>Неравнополочные (63x40)</li>
                    <li>Горячекатаные и гнутые</li>
                </ul>

                <h4>Применение</h4>
                <table>
                    <tr><th>Область</th><th>Примеры</th></tr>
                    <tr><td>Строительство</td><td>Каркасы, опоры</td></tr>
                    <tr><td>Декор</td><td>Оформление фасадов</td></tr>
                    <tr><td>Мебель</td><td>Рамы, каркасы</td></tr>
                </table>

                <h4>Советы по выбору</h4>
                <p>Учитывайте прочностные характеристики и размеры. Проверяйте соответствие ГОСТ 8509-93.</p>`,
            PublishedAt: "2025-08-10",
        },
        {
            Title: "Тенденции в производстве металлопроката",
            ShortText: "Автоматизация улучшает производство. ИИ контролирует качество. Экологичные материалы в тренде.",
            FullText: `
                <h3>Тенденции в производстве металлопроката 2025</h3>
                <p>Металлопрокат остается основой многих отраслей. Тенденции 2025 года включают автоматизацию и экологичные подходы.</p>

                <h4>Ключевые тренды</h4>
                <ul>
                    <li>Автоматизация производственных линий</li>
                    <li>ИИ для контроля качества</li>
                    <li>Экологичные материалы и технологии</li>
                </ul>

                <h4>Примеры внедрения</h4>
                <table>
                    <tr><th>Компания</th><th>Инновация</th></tr>
                    <tr><td>НЛМК</td><td>ИИ-контроль качества</td></tr>
                    <tr><td>Северсталь</td><td>Экологичное производство</td></tr>
                </table>

                <h4>Перспективы</h4>
                <p>Российские заводы внедряют инновации, снижая экологический след и повышая эффективность.</p>`,
            PublishedAt: "2025-09-01",
        },
    }
    for _, a := range seeds {
        var c int
        _ = articlesDB.QueryRow("SELECT COUNT(1) FROM articles WHERE title=?", a.Title).Scan(&c)
        if c == 0 {
            if _, err := articlesDB.Exec("INSERT INTO articles (title, short_text, full_text, published_at) VALUES (?,?,?,?)",
                strings.TrimSpace(a.Title), a.ShortText, a.FullText, a.PublishedAt); err != nil {
                return err
            }
        }
    }
    return nil
}

// Public list of articles with optional year filter
func handleArticlesList(w http.ResponseWriter, r *http.Request) {
    if r.Method != http.MethodGet {
        http.Error(w, "method not allowed", http.StatusMethodNotAllowed)
        return
    }
    year := strings.TrimSpace(r.URL.Query().Get("year"))
    var rows *sql.Rows
    var err error
    if year == "" {
        rows, err = articlesDB.Query("SELECT id, title, short_text, full_text, published_at FROM articles ORDER BY published_at DESC, id DESC")
    } else {
        rows, err = articlesDB.Query("SELECT id, title, short_text, full_text, published_at FROM articles WHERE strftime('%Y', published_at)=? ORDER BY published_at DESC, id DESC", year)
    }
    if err != nil { http.Error(w, err.Error(), http.StatusInternalServerError); return }
    defer rows.Close()
    var out []Article
    for rows.Next() {
        var a Article
        if err := rows.Scan(&a.ID, &a.Title, &a.ShortText, &a.FullText, &a.PublishedAt); err != nil { http.Error(w, err.Error(), 500); return }
        out = append(out, a)
    }
    writeJSON(w, out)
}

// Admin CRUD for articles
func adminArticlesHandler(w http.ResponseWriter, r *http.Request) {
    switch r.Method {
    case http.MethodGet:
        rows, err := articlesDB.Query("SELECT id, title, short_text, full_text, published_at FROM articles ORDER BY published_at DESC, id DESC")
        if err != nil { http.Error(w, err.Error(), 500); return }
        defer rows.Close()
        var out []Article
        for rows.Next() {
            var a Article
            if err := rows.Scan(&a.ID, &a.Title, &a.ShortText, &a.FullText, &a.PublishedAt); err != nil { http.Error(w, err.Error(), 500); return }
            out = append(out, a)
        }
        writeJSON(w, out)
    case http.MethodPost:
        var a Article
        if err := json.NewDecoder(r.Body).Decode(&a); err != nil { http.Error(w, err.Error(), 400); return }
        a.Title = strings.TrimSpace(a.Title)
        a.ShortText = strings.TrimSpace(a.ShortText)
        a.FullText = strings.TrimSpace(a.FullText)
        if a.Title == "" || a.ShortText == "" || a.FullText == "" { http.Error(w, "title, short_text, full_text required", 400); return }
        if strings.TrimSpace(a.PublishedAt) == "" { http.Error(w, "published_at required", 400); return }
        res, err := articlesDB.Exec("INSERT INTO articles (title, short_text, full_text, published_at) VALUES (?,?,?,?)", a.Title, a.ShortText, a.FullText, a.PublishedAt)
        if err != nil { http.Error(w, err.Error(), 500); return }
        id, _ := res.LastInsertId()
        writeJSON(w, map[string]any{"id": id, "status": "ok"})
    case http.MethodPatch:
        var a Article
        if err := json.NewDecoder(r.Body).Decode(&a); err != nil { http.Error(w, err.Error(), 400); return }
        if a.ID == 0 { http.Error(w, "id required", 400); return }
        fields := []string{}
        args := []any{}
        if strings.TrimSpace(a.Title) != "" { fields = append(fields, "title=?"); args = append(args, strings.TrimSpace(a.Title)) }
        // allow clearing fields
        if a.ShortText != "" || a.ShortText == "" { fields = append(fields, "short_text=?"); args = append(args, a.ShortText) }
        if a.FullText != "" || a.FullText == "" { fields = append(fields, "full_text=?"); args = append(args, a.FullText) }
        if strings.TrimSpace(a.PublishedAt) != "" { fields = append(fields, "published_at=?"); args = append(args, strings.TrimSpace(a.PublishedAt)) }
        if len(fields) == 0 { writeJSON(w, map[string]string{"status":"ok"}); return }
        args = append(args, a.ID)
        q := "UPDATE articles SET " + strings.Join(fields, ",") + " WHERE id=?"
        if _, err := articlesDB.Exec(q, args...); err != nil { http.Error(w, err.Error(), 500); return }
        writeJSON(w, map[string]string{"status":"ok"})
    case http.MethodDelete:
        idStr := r.URL.Query().Get("id")
        if idStr == "" { http.Error(w, "id required", 400); return }
        if _, err := articlesDB.Exec("DELETE FROM articles WHERE id= ?", idStr); err != nil { http.Error(w, err.Error(), 500); return }
        writeJSON(w, map[string]string{"status":"ok"})
    default:
        http.Error(w, "method not allowed", 405)
    }
}


